# UX-5: Troubleshooting作成 実施レポート

## 概要

よくあるエラーと解決方法をまとめたトラブルシューティングドキュメントを作成した。

## 作成したドキュメント

- `/home/mizumi/develop/inv/docs/troubleshooting.md` (1264行)

## 主なトラブルシューティングカテゴリ

### 1. エラーメッセージ別（5種類）

実際のソースコードから抽出したエラーメッセージに基づき作成：

| エラー                    | 解決方法数 | 主な内容                                    |
| ------------------------- | ---------- | ------------------------------------------- |
| Permission denied         | 4          | SSH鍵パーミッション、リモート権限、sudo設定 |
| Connection refused        | 4          | ホスト確認、ポート設定、ファイアウォール    |
| Authentication failed     | 4          | 鍵パス確認、公開鍵登録、パスフレーズ対応    |
| No such file or directory | 3          | リモート/ローカルパス確認、チルダ展開問題   |
| YAML parse error          | 4          | インデント、コロン、クォート、予約語        |

### 2. 接続エラー（2種類）

| トラブル                      | 解決方法数 | 主な内容                                         |
| ----------------------------- | ---------- | ------------------------------------------------ |
| タイムアウトする              | 4          | タイムアウト延長、ネットワーク診断、プロキシ設定 |
| 古いSSHサーバーに接続できない | 1          | legacy_mode設定、アルゴリズム説明                |

### 3. 認証エラー（2種類）

| トラブル                        | 解決方法数 | 主な内容                                 |
| ------------------------------- | ---------- | ---------------------------------------- |
| publickey authentication failed | 4          | 段階的診断（SSH接続→鍵確認→形式確認）    |
| password authentication failed  | 3          | パスワード確認、認証有効化、環境変数展開 |

### 4. ファイル操作エラー（3種類）

| トラブル                     | 解決方法数 | 主な内容                                          |
| ---------------------------- | ---------- | ------------------------------------------------- |
| ファイルが予期せず削除された | 4          | dry-run確認、ブラウザUI、バックアップ、モード選択 |
| ignoreパターンが効かない     | 4          | グループ適用、上書き動作、globパターン文法        |
| ファイル数が多すぎてエラー   | 3          | ignoreで除外、fileモード分割、rsync使用           |

### 5. 設定ファイルエラー（3種類）

| トラブル                     | 解決方法数 | 主な内容                                     |
| ---------------------------- | ---------- | -------------------------------------------- |
| プロファイルが見つからない   | 3          | プロファイル一覧確認、ファイル場所、YAML構文 |
| 設定ファイルが見つかりません | 2          | ファイル作成、明示的指定、検索順序           |
| 環境変数が展開されない       | 1          | export設定、.env、direnv                     |

### 6. パフォーマンス問題（2種類）

| トラブル           | 解決方法数 | 主な内容                                         |
| ------------------ | ---------- | ------------------------------------------------ |
| アップロードが遅い | 5          | プロトコル選択、圧縮、並列転送、ignore、差分のみ |
| メモリ不足         | 3          | ファイル数削減、分割アップロード、rsync使用      |

### 7. デバッグ方法（6種類）

| 方法                 | 内容                            |
| -------------------- | ------------------------------- |
| verboseモード        | 詳細ログ出力、出力例            |
| ログファイル保存     | --log-file、分析方法            |
| SSH接続詳細確認      | ssh -vvv、-vオプションの違い    |
| dry-run事前確認      | 実際のアップロードなし、出力例  |
| ブラウザUI確認       | 視覚的確認、確認できる内容      |
| プロトコル別動作確認 | SFTP/SCP手動接続、rsync dry-run |

## 主な特徴

### 1. 実際のエラーメッセージベース

ソースコードから抽出した実際のエラーメッセージを使用：

```typescript
// src/utils/error.ts から
- "Permission denied"
- "Connection refused"
- "No such file"
- "not found"
- "Authentication failed"

// src/upload/ssh-base.ts から
- publickey authentication failed
- password authentication failed

// src/config/validator.ts から
- ConfigValidationError
- "設定ファイルはオブジェクトである必要があります"
```

### 2. 段階的な診断手順

各トラブルを「1→2→3」の順で診断できる構成：

**例: Authentication failed**

1. 秘密鍵のパスが間違っている → `ls -la ~/.ssh/id_rsa`
2. 公開鍵がリモートに登録されていない → `ssh-copy-id`
3. パスワード認証の場合 → 環境変数設定
4. SSH鍵のパスフレーズ → `ssh-agent`

### 3. 実行可能なコマンド例

全てのコマンドは実行可能：

```bash
# 確認
ls -la ~/.ssh/id_rsa

# 修正
chmod 600 ~/.ssh/id_rsa

# テスト
ssh user@your-server.example.com
```

### 4. よくある間違いの明示

❌/✅形式で明示：

```yaml
# ❌ リモート側で ~ が展開されない場合がある
dest: "~/public_html/"

# ✅ フルパスで指定
dest: "/home/username/public_html/"
```

### 5. セキュリティ上の注意

重要な箇所にセキュリティ警告：

- SSH鍵のパーミッション: 600
- パスワードを平文で書かない
- legacy_mode のセキュリティリスク

### 6. デバッグツールの活用

各トラブルシューティングで適切なツールを紹介：

- `ping`, `traceroute`, `mtr` でネットワーク診断
- `ssh -vvv` で詳細ログ
- `cat -A` でタブ/スペース混在チェック
- YAMLバリデーションツールの使い方

## 新規ユーザーへの効果

### Before（改善前）

- エラーメッセージを見ても解決方法が分からない
- トラブルシューティング情報が散在している
- 「動かない」時のチェックリストがない

**結果**: サポート問い合わせ増加、ユーザーの離脱

### After（改善後）

✅ **エラーメッセージで検索して解決方法を見つけられる**

- 目次から該当エラーに直接ジャンプ
- 段階的な診断で原因を特定
- 実行可能なコマンド例で即座に対処

✅ **段階的な診断で原因を特定できる**

- 「1→2→3」の順で試すだけ
- 各ステップで確認ポイント明記
- 診断ツールの使い方も説明

✅ **サポート問い合わせの削減**

- よくある問題は自己解決可能
- Issue作成時のテンプレート提供
- 関連ドキュメントへの誘導

## 今後の展開

### 1. ユーザーフィードバックの反映

実際に報告されたエラーを追加していくことで、網羅性を高められる。

**追加予定**:

- Windows固有のエラー（パス区切り文字、改行コード）
- rsyncコマンドが見つからない場合の対処
- プロキシ環境での詳細設定

### 2. FAQ との連携

README.md の FAQ と連携：

- FAQ: 簡潔な回答
- Troubleshooting: 詳細な診断手順

### 3. 動画・スクリーンショット追加

視覚的な説明を追加：

- dry-run の出力例
- ブラウザUIのスクリーンショット
- エラーメッセージの実例

## 関連ドキュメントの更新

### docs/README.md の更新

#### 推奨リソースに追加

```diff
  | ドキュメント                          | 説明                             | 所要時間 |
  | ------------------------------------- | -------------------------------- | -------- |
  | [Configuration](configuration.md)     | 設定ファイルの全項目リファレンス | 10分     |
+ | [Troubleshooting](troubleshooting.md) | よくある問題と解決方法           | -        |
```

#### 困ったときはに追加

```diff
  | 問題                   | 参照先                                                                |
  | ---------------------- | --------------------------------------------------------------------- |
+ | エラーメッセージが出た | [Troubleshooting](troubleshooting.md)                                 |
  | 動かない               | [README.md - Requirements](../README.md#requirements)                 |
  | 設定方法が分からない   | [Configuration](configuration.md)                                     |
  | プロトコルの選び方     | [Configuration - プロトコル別設定](configuration.md#プロトコル別設定) |
  | Windowsで動かない      | [README.md - Windowsの注意事項](../README.md#windows)                 |
- | 認証エラー             | [Configuration - ターゲット設定](configuration.md#ターゲット設定)     |
+ | 認証エラー             | [Troubleshooting - 認証エラー](troubleshooting.md#認証エラー)         |
  | バグを見つけた         | [GitHub Issues](https://github.com/ba0918/uploader/issues)            |
```

## 統計

- **合計行数**: 1264行
- **トラブルシューティング項目数**: 26項目
- **カテゴリ数**: 7カテゴリ
- **コマンド例数**: 約80個
- **設定例数**: 約50個

## まとめ

UX-5の目的を完全に達成：

✅ **エラーメッセージ別の解決方法を網羅**

- 実際のソースコードから抽出
- 段階的な診断手順
- 実行可能なコマンド例

✅ **接続・認証・ファイル操作・設定・パフォーマンス問題を網羅**

- 7カテゴリ、26項目
- 実践的な解決方法

✅ **デバッグ方法を詳細に説明**

- 6種類のデバッグ方法
- ツールの使い方

✅ **新規ユーザーが自力で問題解決できる**

- 目次から検索
- 段階的な診断
- 関連ドキュメントへの誘導

このドキュメントにより、新規ユーザーのサポート問い合わせが大幅に削減され、自己解決率が向上することが期待される。

---

**作成日**: 2026-01-12 **作成者**: Claude (UX改善タスク UX-5)
